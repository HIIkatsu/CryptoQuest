<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CryptoQuest</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

*{margin:0;padding:0;box-sizing:border-box}

body{
    font-family:Inter,sans-serif;
    background:radial-gradient(ellipse at top,#0a0a1f 0%,#000 70%);
    color:#fff;
    min-height:100vh;
    overflow-x:hidden;
}

.stars-bg{position:fixed;inset:0;z-index:1;pointer-events:none}
.star{position:absolute;background:#4da8ff;border-radius:50%;opacity:.5}

.container{
    max-width:400px;
    margin:0 auto;
    padding:28px 24px 120px;
    position:relative;
    z-index:10;
}

.header{text-align:center;margin-bottom:32px}
.logo{
    font-size:36px;
    font-weight:700;
    background:linear-gradient(135deg,#4da8ff,#a8d8ff);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}
.subtitle{
    margin-top:6px;
    font-size:14px;
    color:#b8b8d0;
    background:rgba(20,20,35,.8);
    padding:8px 14px;
    border-radius:20px;
    display:inline-block;
}

.stats-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:16px;
    margin-bottom:28px;
}

.stat-card{
    background:rgba(20,20,35,.9);
    border:1px solid rgba(77,168,255,.2);
    border-radius:18px;
    padding:22px;
    text-align:center;
}

.balance{
    font-size:28px;
    font-weight:700;
    background:linear-gradient(135deg,#4da8ff,#7dc8ff);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}
.stat-value{font-size:26px;color:#4da8ff;font-weight:700}
.stat-label{font-size:14px;color:#9a9ab0}

.map-section{
    background:rgba(10,10,25,.95);
    border-radius:22px;
    padding:22px;
    margin-bottom:32px;
    border:1px solid rgba(77,168,255,.15);
}

.map-header{
    color:#4da8ff;
    font-weight:600;
    margin-bottom:14px;
}

#map{
    width:100%;
    height:260px;
    border-radius:16px;
}

.action-section{display:flex;flex-direction:column;gap:16px}

.btn-main{
    background:linear-gradient(135deg,rgba(77,168,255,.25),rgba(125,200,255,.1));
    border:2px solid rgba(77,168,255,.5);
    border-radius:18px;
    padding:22px;
    font-size:18px;
    font-weight:600;
    color:#fff;
}

.btn-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}

.btn-secondary{
    background:rgba(30,30,50,.85);
    border:1px solid rgba(255,255,255,.15);
    border-radius:16px;
    padding:18px;
    font-size:15px;
    color:#e0e0e0;
}
</style>
</head>

<body>

<div class="stars-bg" id="stars"></div>

<div class="container">
    <div class="header">
        <div class="logo">CryptoQuest</div>
        <div class="subtitle">AR Token Hunt ‚Ä¢ –ú–æ—Å–∫–≤–∞ 2026</div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="balance" id="balance">0 QTZ</div>
            <div class="stat-label">–¢–≤–æ–π –±–∞–ª–∞–Ω—Å</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">18</div>
            <div class="stat-label">–∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–æ–Ω</div>
        </div>
    </div>

    <div class="map-section">
        <div class="map-header">üó∫Ô∏è –ö–∞—Ä—Ç–∞ —Å–æ–∫—Ä–æ–≤–∏—â</div>
        <div id="map"></div>
    </div>

    <div class="action-section">
        <button class="btn-main" id="startQuestBtn">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–≤–µ—Å—Ç</button>
        <div class="btn-grid">
            <button class="btn-secondary" id="scanBtn">üîç AR —Å–∫–∞–Ω–µ—Ä</button>
            <button class="btn-secondary" id="marketBtn">üíé P2P —Ä—ã–Ω–æ–∫</button>
        </div>
    </div>
</div>

<script>
/* ===== STARS ===== */
for(let i=0;i<120;i++){
    const s=document.createElement('div');
    s.className='star';
    s.style.width=s.style.height=Math.random()>0.5?'2px':'1px';
    s.style.left=Math.random()*100+'%';
    s.style.top=Math.random()*100+'%';
    document.getElementById('stars').appendChild(s);
}

/* ===== TELEGRAM ===== */
const tg=Telegram.WebApp;
tg.ready();
tg.expand();

let balance=0;
function updateBalance(v){
    balance+=v;
    document.getElementById('balance').innerText=balance+' QTZ';
    tg.MainButton.setText('üí∞ '+balance+' QTZ');
}
tg.MainButton.setText('üí∞ 0 QTZ').show();

/* ===== BUTTONS ===== */
startQuestBtn.onclick=()=>{
    updateBalance(5);
    tg.showAlert('üöÄ –ö–≤–µ—Å—Ç –∑–∞–ø—É—â–µ–Ω\n+5 QTZ');
};

scanBtn.onclick=()=>{
    if(!tg.showScanQrPopup){
        tg.showAlert('QR —Å–∫–∞–Ω–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
        return;
    }
    tg.showScanQrPopup(
        {text:'–ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥'},
        ()=>{
            tg.closeScanQrPopup();
            updateBalance(5);
            tg.showAlert('‚úÖ QR –Ω–∞–π–¥–µ–Ω\n+5 QTZ');
        }
    );
};

marketBtn.onclick=()=>{
    tg.showAlert('üíé P2P —Ä—ã–Ω–æ–∫ —Å–∫–æ—Ä–æ');
};

/* ===== MAP + GPS ===== */
let map,userMarker;

map=L.map('map',{zoomControl:false,attributionControl:false})
    .setView([55.7558,37.6176],11);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19})
.addTo(map);

const spots=[
    ['–¢—Ä—É–±–Ω–∞—è –ø–ª–æ—â–∞–¥—å',55.7655,37.6203],
    ['–ü–∞—Ä–∫ –ì–æ—Ä—å–∫–æ–≥–æ',55.7301,37.6010],
    ['–º. –©—ë–ª–∫–æ–≤—Å–∫–∞—è',55.8094,37.7983]
];

spots.forEach(s=>{
    L.circleMarker([s[1],s[2]],{
        radius:8,color:'#4da8ff',fillOpacity:.9
    }).addTo(map)
    .bindPopup(`<b>${s[0]}</b><br>üîç –ò—â–∏ QR —Ä—è–¥–æ–º`);
});

if(navigator.geolocation){
    navigator.geolocation.watchPosition(pos=>{
        const lat=pos.coords.latitude;
        const lng=pos.coords.longitude;
        if(!userMarker){
            userMarker=L.circleMarker([lat,lng],{
                radius:8,color:'#00d4ff',fillOpacity:1
            }).addTo(map);
        }else{
            userMarker.setLatLng([lat,lng]);
        }
    },()=>{}, {enableHighAccuracy:true});
}

setTimeout(()=>map.invalidateSize(),400);
</script>

</body>
</html>
