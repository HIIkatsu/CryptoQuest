<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CryptoQuest</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body{background:radial-gradient(ellipse at top,#0a0a1f 0%,#000 70%);color:#fff;min-height:100vh;overflow-x:hidden;}
.stars-bg{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1;}
.star{position:absolute;border-radius:50%;opacity:0.6;animation:twinkle 4s ease-in-out infinite;}
.star.big{width:2px;height:2px;}
.star.medium{width:1px;height:1px;}
.star.small{width:0.5px;height:0.5px;}
@keyframes twinkle{0%,100%{opacity:0.4;transform:scale(1);}50%{opacity:1;transform:scale(1.4);}}
.container{max-width:400px;margin:0 auto;padding:28px 24px;position:relative;z-index:10;min-height:100vh;padding-bottom:100px;}
.header{text-align:center;margin-bottom:20px;}
.logo{font-size:36px;font-weight:700;background:linear-gradient(135deg,#4da8ff 0%,#7dc8ff 50%,#a8d8ff 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 0 20px rgba(77,168,255,0.3);margin-bottom:8px;}
.subtitle{font-size:15px;color:#b8b8d0;font-weight:400;background: rgba(20,20,35,0.8);padding:6px 12px;border-radius:20px;display:inline-block;backdrop-filter: blur(20px); border:1px solid rgba(77,168,255,0.1);}
.tabs{display:flex; gap:8px; margin-bottom:16px;}
.tab{flex:1; padding:10px; background: rgba(30,30,50,0.8); border-radius:12px; text-align:center; cursor:pointer; user-select:none; transition:0.3s;}
.tab.active{background: linear-gradient(135deg,#4da8ff,#7dc8ff); color:#000;}
.tab-content{display:none;}
.tab-content.active{display:block;}
.stats-grid{display:grid;grid-template-columns:1fr 1fr; gap:16px; margin-bottom:16px;}
.stat-card{background: rgba(20,20,35,0.9); backdrop-filter:blur(20px); border:1px solid rgba(77,168,255,0.2); border-radius:16px; padding:16px; text-align:center;}
.balance,.level-display{font-size:28px;font-weight:700;background:linear-gradient(135deg,#4da8ff,#7dc8ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.stat-value{font-size:26px;font-weight:700;color:#4da8ff;margin-bottom:4px;}
.stat-label{font-size:14px;color:#9a9ab0;font-weight:500;}
.map-section{background: rgba(10,10,25,0.95);backdrop-filter: blur(25px);border:1px solid rgba(77,168,255,0.15);border-radius:20px;padding:16px; margin-bottom:16px;}
#map{width:100%; height:220px; border-radius:16px; box-shadow:0 8px 32px rgba(0,0,0,0.4);}
.action-section{display:flex; flex-direction:column; gap:12px; margin-bottom:16px;}
.btn-main,.btn-secondary{padding:12px 16px; border-radius:12px; border:none; cursor:pointer; font-weight:600; transition:0.3s;}
.btn-main{background:linear-gradient(135deg,rgba(77,168,255,0.2),rgba(125,200,255,0.1)); color:#fff;}
.btn-main:hover{background:rgba(77,168,255,0.3);}
.btn-secondary{background:rgba(30,30,50,0.8); color:#e0e0e0;}
.btn-secondary:hover{background:rgba(50,50,75,0.9);}
.upgrade-card{background: rgba(20,20,35,0.9); padding:12px; border-radius:12px; margin-bottom:12px;}
.quests-section .quest-card{margin-bottom:10px; padding:10px; background: rgba(30,30,50,0.8); border-radius:8px;}
.quests-section .quest-card button{margin-top:6px; padding:6px 10px; border-radius:6px; border:none; cursor:pointer; background:#4da8ff; color:#000;}
</style>
</head>
<body>
<div class="stars-bg" id="stars"></div>
<div class="container">
<div class="header">
<div class="logo">CryptoQuest</div>
<div class="subtitle">AR Token Hunt ‚Ä¢ –ú–æ—Å–∫–≤–∞ 2026</div>
</div>

<div class="tabs">
<div class="tab active" data-tab="main">–ì–ª–∞–≤–Ω–∞—è</div>
<div class="tab" data-tab="upgrades">–ü—Ä–æ–∫–∞—á–∫–∏</div>
<div class="tab" data-tab="quests">–ó–∞–¥–∞–Ω–∏—è</div>
</div>

<div class="tab-content active" id="main">
<div class="stats-grid">
<div class="stat-card">
<div class="balance" id="balance">0 QTZ</div>
<div class="level-display" id="level">–£—Ä–æ–≤–µ–Ω—å: 1</div>
<div class="stat-label">–¢–≤–æ–π –±–∞–ª–∞–Ω—Å</div>
</div>
<div class="stat-card">
<div class="stat-value" id="activeZones">0</div>
<div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–æ–Ω</div>
</div>
</div>

<div class="map-section">
<div id="map"></div>
</div>

<div class="action-section">
<button class="btn-main" id="startQuestBtn">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–≤–µ—Å—Ç</button>
<div style="display:flex; gap:8px;">
<button class="btn-secondary" id="scanBtn">üîç AR —Å–∫–∞–Ω–µ—Ä</button>
<button class="btn-secondary" id="marketBtn">üíé P2P —Ä—ã–Ω–æ–∫</button>
</div>
</div>
</div>

<div class="tab-content" id="upgrades">
<div class="upgrade-card">
<div>üìç –¢–æ—á–Ω–æ—Å—Ç—å –ª–æ–∫–∞—Ü–∏–∏: <span id="upgradeLocation">1 —É—Ä–æ–≤–µ–Ω—å</span></div>
<button onclick="buyUpgrade('location')">–ü–æ–≤—ã—Å–∏—Ç—å</button>
</div>
<div class="upgrade-card">
<div>‚è±Ô∏è –°–Ω–∏–∂–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: <span id="upgradeCooldown">1 —É—Ä–æ–≤–µ–Ω—å</span></div>
<button onclick="buyUpgrade('cooldown')">–ü–æ–≤—ã—Å–∏—Ç—å</button>
</div>
<div class="upgrade-card">
<div>üí∞ –ë–æ–Ω—É—Å –∑–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: <span id="upgradeReward">1 —É—Ä–æ–≤–µ–Ω—å</span></div>
<button onclick="buyUpgrade('reward')">–ü–æ–≤—ã—Å–∏—Ç—å</button>
</div>
<div class="upgrade-card">
<div>üîì –î–æ—Å—Ç—É–ø –∫ –Ω–æ–≤—ã–º —Ç–æ—á–∫–∞–º: <span id="upgradeAccess">1 —É—Ä–æ–≤–µ–Ω—å</span></div>
<button onclick="buyUpgrade('access')">–ü–æ–≤—ã—Å–∏—Ç—å</button>
</div>
</div>

<div class="tab-content" id="quests">
<div class="quests-section">
<h2>üéØ –ó–∞–¥–∞–Ω–∏—è</h2>
<div id="questsList"></div>
</div>
</div>
</div>

<script>
'use strict';

// –ó–≤—ë–∑–¥—ã
const starsContainer = document.getElementById('stars');
['big','medium','small'].forEach(size=>{
    for(let i=0;i<50;i++){
        const star=document.createElement('div');
        star.className='star '+size;
        star.style.left=Math.random()*100+'%';
        star.style.top=Math.random()*100+'%';
        star.style.animationDelay=Math.random()*5+'s';
        star.style.animationDuration=(Math.random()*3+2)+'s';
        starsContainer.appendChild(star);
    }
});

// Tabs
document.querySelectorAll('.tab').forEach(tab=>{
    tab.addEventListener('click',()=>{
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
    });
});

// Telegram WebApp
const tg = window.Telegram?.WebApp;
tg?.ready();
tg?.expand();
tg?.MainButton?.setText('üí∞ –ö–æ—à–µ–ª—ë–∫').show().onClick(()=>alert(`–ë–∞–ª–∞–Ω—Å: ${balance} QTZ`));

// –ë–∞–ª–∞–Ω—Å, –ø—Ä–æ–∫–∞—á–∫–∏ –∏ —É—Ä–æ–≤–Ω–∏
let balance=0;
let exp=0;
let level=1;
let upgrades={
    location:{level:1},
    cooldown:{level:1},
    reward:{level:1},
    access:{level:1}
};
function gainExp(amount){
    exp+=amount;
    let nextLevel=level*10;
    if(exp>=nextLevel){level++; exp=0; document.getElementById('level').innerText='–£—Ä–æ–≤–µ–Ω—å: '+level; renderMapMarkers(); renderQuests();}
}
function buyUpgrade(type){
    const cost = upgrades[type].level*5;
    if(balance>=cost){
        balance-=cost;
        upgrades[type].level++;
        updateUpgradesUI();
        updateBalance();
        renderMapMarkers();
        renderQuests();
    } else alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ QTZ');
}
function updateUpgradesUI(){
    document.getElementById('upgradeLocation').innerText=upgrades.location.level+' —É—Ä–æ–≤–µ–Ω—å';
    document.getElementById('upgradeCooldown').innerText=upgrades.cooldown.level+' —É—Ä–æ–≤–µ–Ω—å';
    document.getElementById('upgradeReward').innerText=upgrades.reward.level+' —É—Ä–æ–≤–µ–Ω—å';
    document.getElementById('upgradeAccess').innerText=upgrades.access.level+' —É—Ä–æ–≤–µ–Ω—å';
}
function updateBalance(){document.getElementById('balance').innerText=balance+' QTZ';}

// –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã
let dailyQuests=[];
function generateDailyQuests(){
    dailyQuests=[
        {id:'daily1',name:'–ù–∞–π–¥–∏ 2 QR-–∫–æ–¥–∞ —Å–µ–≥–æ–¥–Ω—è',progress:0,goal:2,reward:5,completed:false,daily:true},
        {id:'daily2',name:'–°–∫–∞–Ω–∏—Ä—É–π —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É',progress:0,goal:1,reward:8,completed:false,daily:true}
    ];
    renderQuests();
}
generateDailyQuests();

// –ó–∞–¥–∞–Ω–∏—è
let quests = [
    {id:'secretQuest',name:'üîí –°–µ–∫—Ä–µ—Ç–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ',progress:0,goal:1,reward:20,completed:false,secret:true,unlockLevel:2}
];
function renderQuests(){
    const container=document.getElementById('questsList');
    container.innerHTML='';
    [...dailyQuests,...quests].forEach(q=>{
        if(q.secret && upgrades.access.level<q.unlockLevel) return;
        let status=q.completed?'‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ':`${q.progress}/${q.goal}`;
        let btn=q.completed?'':`<button onclick="completeQuest('${q.id}')">–û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>`;
        container.innerHTML+=`<div class="quest-card"><div>${q.name}</div><div>–ü—Ä–æ–≥—Ä–µ—Å—Å: ${status}</div>${btn}</div>`;
    });
}
function completeQuest(id){
    let q=[...dailyQuests,...quests].find(x=>x.id===id);
    if(!q || q.completed) return;
    q.progress++;
    if(q.progress>=q.goal){q.completed=true; balance+=q.reward; gainExp(5); updateBalance(); alert(`üéâ –ó–∞–¥–∞–Ω–∏–µ "${q.name}" –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! +${q.reward} QTZ`);}
    renderQuests();
}

// –ö–∞—Ä—Ç–∞ –∏ —Ç–æ—á–∫–∏
let mapInitialized=false;
let map;
let questSpots=[
    {id:'tubnaya',name:'–¢—Ä—É–±–Ω–∞—è –ø–ª.',coords:[55.7655,37.6203],color:'#4da8ff',hidden:false},
    {id:'mitino',name:'–†–∞–¥–∏–æ—Ä—ã–Ω–æ–∫ –ú–∏—Ç–∏–Ω–æ',coords:[55.8451,37.3614],color:'#7dc8ff',hidden:false},
    {id:'gorky',name:'–ü–∞—Ä–∫ –ì–æ—Ä—å–∫–æ–≥–æ',coords:[55.7301,37.6010],color:'#4da8ff',hidden:false},
    {id:'dns',name:'DNS –ú—ã—Ç–∏—â–∏',coords:[55.9105,37.7365],color:'#7dc8ff',hidden:false},
    {id:'shchel',name:'–ú–µ—Ç—Ä–æ –©—ë–ª–∫–æ–≤—Å–∫–æ–µ',coords:[55.8199,37.8822],color:'#7dc8ff',hidden:true},
];
function initMap(){
    if(mapInitialized||!window.L)return;
    mapInitialized=true;
    map=L.map('map',{zoomControl:false,attributionControl:false,minZoom:10}).setView([55.7558,37.6176],11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:''}).addTo(map);
    renderMapMarkers();
}
function renderMapMarkers(){
    map.eachLayer((layer)=>{if(layer instanceof L.CircleMarker) map.removeLayer(layer);});
    questSpots.forEach(spot=>{
        if(spot.hidden && upgrades.access.level<2) return;
        const latOffset=(Math.random()-0.5)/upgrades.location.level;
        const lonOffset=(Math.random()-0.5)/upgrades.location.level;
        const marker=L.circleMarker([spot.coords[0]+latOffset, spot.coords[1]+lonOffset],{radius:8,color:spot.color,weight:2,fillColor:spot.color,fillOpacity:0.85}).addTo(map);
        marker.bindPopup(`<b>${spot.name}</b><br><span style="color:${spot.color}">üîç –ò—â–∏ QR-–∫–æ–¥ —Ä—è–¥–æ–º!</span>`);
        marker.on('click',()=>{
            const reward=1*upgrades.reward.level;
            balance+=reward; gainExp(2); updateBalance();
            alert(`üìç ${spot.name} ‚Äî QR-–∫–æ–¥ –Ω–∞–π–¥–µ–Ω! +${reward} QTZ`);
            completeQuest('daily1');
            if(level>=2) completeQuest('secretQuest');
        });
    });
    document.getElementById('activeZones').innerText=questSpots.length;
}
window.addEventListener('load',initMap);
setTimeout(initMap,1000);

// –ö–Ω–æ–ø–∫–∏
document.getElementById('startQuestBtn').addEventListener('click',()=>{alert('üöÄ –ö–≤–µ—Å—Ç –∑–∞–ø—É—â–µ–Ω! –°–∫–∞–Ω–∏—Ä—É–π QR-–∫–æ–¥—ã –¥–ª—è –Ω–∞–≥—Ä–∞–¥');});
document.getElementById('scanBtn').addEventListener('click',()=>{
    if(tg?.showScanQrPopup){
        tg.showScanQrPopup({text:'–ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥'},(data)=>{
            const reward=5*upgrades.reward.level;
            balance+=reward; gainExp(2); updateBalance();
            alert(`‚úÖ QR-–∫–æ–¥ –Ω–∞–π–¥–µ–Ω! +${reward} QTZ`);
            completeQuest('daily1');
            if(level>=2) completeQuest('secretQuest');
        });
    } else {balance+=3; gainExp(2); updateBalance(); alert('üîç –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫–∞–Ω: +3 QTZ');}
});
document.getElementById('marketBtn').addEventListener('click',()=>alert('üíé P2P —Ä—ã–Ω–æ–∫\n–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –±—É–¥–µ—Ç:\n‚Ä¢ –ö—É–ø–∏—Ç—å QTZ\n‚Ä¢ –ü—Ä–æ–¥–∞—Ç—å QTZ\n‚Ä¢ –û–±–º–µ–Ω –Ω–∞ TON'));

// –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–±—Ä–æ—Å
setInterval(()=>{
    const now=new Date();
    if(now.getHours()===0 && now.getMinutes()===0){ // –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00
        generateDailyQuests();
        dailyQuests.forEach(q=>{q.completed=false; q.progress=0;});
        alert('üóìÔ∏è –ù–æ–≤—ã–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è!');
        renderQuests();
    }
},60000);
</script>
</body>
</html>
